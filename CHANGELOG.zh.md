# 更新日志

[English](./CHANGELOG.md) | 中文

本项目的所有重要更改都将记录在此文件中。

## 0.14.0 - 2026-02-03

### 新功能
- **Job DAG 可视化**: 在 Job 详情页新增了完整 DAG 视图。现在可以将各个 Stage 的 DAG 拼接在一起展示，每个 Stage 都有独立的边框区分，并根据 RDD 依赖关系自动连接。

### 修复
- **SQL 歧义修复**: 修复了 `getJobExecutorSummary` 接口中由于 `tasks` 和 `stages` 表存在同名字段导致的 `Binder Error` 报错。

## 0.13.0 - 2026-02-03

### 新功能
- **定时日志解析**: 实现了 `EventLogWatcherService`，可定时（默认10秒）扫描并增量解析新增或变更的 EventLog 文件。
- **增强诊断规则**: 更新了数据倾斜和 GC 压力的诊断逻辑，新增了可配置的绝对阈值检查（如最大任务耗时 > 1秒，单任务 GC > 800毫秒），结合相对统计指标进行更精准的告警。
- **Docker 支持**: 新增基于 Bitnami Spark 3.5 的 `Dockerfile` 和 `docker-compose.yml`，支持与 Spark History Server 集成部署。

### 改进
- **UI 修复**: 恢复了 Stage 详情页丢失的指标卡片，并修复了 "所属 Job" 链接的跳转问题。

## 0.12.1 - 2026-02-03

### 改进
- **对标 Spark Web UI**:
    - Job 列表默认按 `Job ID` 倒序排列。
    - Job 列表列名更新为 "Job ID (Job Group)"，并优化了长 Job Group 名称的 Badge 样式。
- **UI 优化**:
    - 优化了应用列表页，支持超长 App ID 的自动换行显示，并增加了列宽。

## 0.12.0 - 2026-02-03

### 新功能
- **Stage 重试支持**: 完美支持同一 Stage ID 的多次 Attempt 展示与区分。
    - **后端升级**: 更新数据库 Schema 以追踪 Task 和 Stage 的 `attempt_id`。修复了多 Attempt 导致的 `TooManyResultsException`，API 现在默认返回最新 Attempt 或支持指定 Attempt。
    - **前端适配**: Stage 列表现显示 `(Attempt X)` 标识。详情页、时间轴和任务列表实现了严格的 Attempt 隔离，避免数据混淆。

## 0.11.0 - 2026-02-03

### 新功能
- **数据质量治理前置**: `JacksonEventParser` 现在会在解析阶段自动识别并标记不完整的应用日志（如缺失 `ApplicationEnd` 事件），并持久化到数据库。
- **健壮的诊断报告**: 诊断 Markdown 报告现在能优雅地处理缺失的时间数据，并对“坏点”数据展示明显的视觉警告。

### 修复
- **大 JSON 支持**: (v0.10.1) 修复了解析超过 20MB 的超大 EventLog 行时失败的问题。

## 0.10.1 - 2026-02-03

### 新功能
- **大小写不敏感搜索**：应用列表搜索框现在支持对应用名称、ID 和用户名的不区分大小写搜索。
- **执行器时间轴 (Executor Timeline)**：新增执行器可视化时间轴，用于追踪集群中任务的执行情况。
- **UI 标准化**：
    - 简化了应用列表，移除了 "Action" 列，并将 "App Name" 修改为可直接点击跳转的链接。
    - 统一了作业 (Jobs)、阶段 (Stages) 和应用列表中的表格链接样式和悬停行为。
    - 增强了阶段 DAG 和详情视图，改进了渲染稳定性和间距。

### 重构
- **代码清理**：精简了后端 `listApps` 逻辑，利用 DuckDB 的 `ILIKE` 提高了查询效率并减少了冗余。

## 0.9.0 - 2026-02-02

### 新功能
- **RDD 血缘图 V3**：彻底重构了 DAG 可视化效果。
    - **视觉对标**：复刻 Spark UI 经典配色（Scope 边框 `#A0DFFF`，RDD 填充 `#C3EBFF`，深色连线 `#444`）。
    - **渲染引擎升级**：采用“扁平化 X6 + Dagre 布局”方案，彻底解决了坐标偏移和节点丢失问题。
    - **智能加载**：引入防抖加载（Debounce Loading）机制，完美处理卡片折叠/展开时的渲染时序。
- **Event Timeline V2**：
    - **动态布局**：行高增加至 50px，图表高度随 Executor 数量自动伸缩，信息展示更从容。
    - **图例集成**：将图例移入卡片标题栏内部，移除了冗余的底部状态条，界面更紧凑。

### 修复
- **图表消失问题**：修复了在折叠或刷新页面后，图表因容器尺寸计算错误而无法显示（或跑到底部）的严重 Bug。
- **性能优化**：解耦了趋势图与甘特图的 DataZoom 联动，消除了操作卡顿。

## 0.8.0 - 2026-02-02

### 新功能
- **深度 Event Timeline 重构**：将时间轴升级为双图组合视图。
    - **并发趋势图**：新增按 Executor 堆叠的面积图，实时展示集群资源利用率。
    - **增强型甘特图**：按 Executor 分组展示 Task，支持 8 种耗时维度的色彩分解。
    - **智能交互**：统一了十字准星辅助线及跨图表一致的悬浮详情面板。
- **RDD 血缘图 V2**：显著增强了 DAG 可视化，支持 Scope 分组（将 RDD 嵌套在 WholeStageCodegen 等算子中），并引入 Dagre 引擎优化自动布局。
- **全局交互锁**：为所有复杂图表（时间轴、DAG）引入了缩放锁定/解锁机制，默认锁定以防止页面滚动时的操作干扰。
- **全站 Duration 排序**：彻底修复了 Job 和 Stage 列表无法按耗时排序的问题。通过在数据库中持久化计算后的毫秒值，并优化 SQL 列名引用，实现了高性能的后端排序。
- **UI 组件化升级**：将“缩放锁”等控制按钮统一整合进 `CollapsibleCard` 的标题栏插槽，提升了界面的整洁度。

### 优化
- **布局精准对齐**：统一了所有图表的 Grid 边距，确保上下视图的时间轴完美垂直对齐。
- **响应式增强**：引入 `ResizeObserver` 替代不稳定的延时渲染，确保图表在各种窗口尺寸下都能即时填满容器。

## 0.7.0 - 2026-02-02

### 新功能
- **RDD DAG 可视化**：引入 AntV X6 与 Dagre 引擎，实现 Stage 内部的 RDD 血缘图。支持 Operation Scope 分组（如 WholeStageCodegen）、RDD 依赖关系连线及代码调用位置（Call Site）显示。
- **Stage 概览增强**：将原 Stage Overview 合并入 Summary Metrics 矩阵。新增 `Total` 列，完整展示该 Stage 在所有指标维度上的资源消耗总量（累加/最大值）。
- **指标选择器优化**：重构指标选择卡片为响应式等宽网格布局。列数随分辨率自适应调整（高分辨率 10 列，中分辨率 5 列等），彻底解决排列不齐的问题。
- **指标全量覆盖**：补全了 Output、Shuffle Read 等缺失指标，并在全站范围内统一了指标命名规范。
- **后端算力升级**：增强了 Stage 预计算引擎，新增 10+ 项聚合指标的自动统计逻辑。

### 修复
- **渲染健壮性**：修复了在数据加载完成前跳转详情页导致的 `TypeError` 报错。
- **UI 细节修复**：恢复了丢失的 CSS 样式，修复了长指标名称被截断的问题。

## 0.6.0 - 2026-02-01

### 新功能
- **Job 详情页**：实现专用 Job 详情视图，支持 Job 级别的 Executor 聚合指标及 Stage 列表过滤。
- **环境页深度重构**：完整覆盖 Spark, Hadoop, JVM, System 及类路径配置，支持分块搜索与折叠。
- **Executor 视图升级**：新增 15+ 性能指标（各类峰值内存、存储分代、磁盘等）及 Add/Remove 生命周期跟踪。
- **Stage 列表增强**：新增提交时间、耗时、数据流转列，并引入任务进度条可视化。
- **高级排序功能**：全站所有卡片（Jobs, Stages, Executors, Tasks, Metrics）统一支持多列组合排序及状态条。
- **状态持久化**：通过 URL 子路径支持标签页深度链接，刷新页面可保留当前视图状态。
- **数据准确性优化**：修复 Task 成功状态识别逻辑，增强 Job 描述提取（支持 Call Site 追溯），统一 0 值掩码显示。
- **UI 规范化**：统一表格链接样式、表头命名规范及悬停高亮逻辑。

## 0.4.0 - 2026-02-01

### 新功能
- 新增 **Aggregated Metrics by Executor** 模块，支持按 Executor 聚合分析指标
- 新增 **指标选择器**，支持动态控制各组件中指标列/行的可见性
- 为 Stage 详情页的所有模块实现 **可折叠卡片** 功能
- 在页眉建立 Stage 与其所属 Job 的关联，支持点击跳转
- 优化记录数显示，同时支持精确计数与易读格式（如 `1,234 (1.2 K)`）
- 重构导航栏布局与样式，深度对标 Spark Web UI 体验
- 修复 Task 耗时与调度延迟计算逻辑，提升数据准确性

## 0.1.0 - 2026-02-01

### 新功能
- 启用任务表多列排序
- 增强作业/阶段分析及与 Spark History Server 的 UI 一致性
- 实现前端自动打包进 JAR

### 重构
- 模块化阶段详情并增强环境标签页
